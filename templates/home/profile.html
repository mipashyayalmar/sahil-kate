{% block content %}

<!DOCTYPE html>
<html lang="en">
<head>
{% load static %}
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="keywords" content="Bootstrap, Landing page, Template, Business, Service">
  <meta name="author" content="Grayrids">
  <title>Navaratri Dandiya - {% if is_admin %}Admin Dashboard{% else %}Profile{% endif %}</title>
  <link rel="shortcut icon" href="{% static 'img/favicon_io/android-chrome-512x512.png' %}" type="image/png">
  <link rel="shortcut icon" href="{% static 'img/favicon_io/android-chrome-192x192.png' %}" type="image/png">

  <!-- Stylesheets -->
  <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
  <link rel="stylesheet" href="{% static 'css/animate.css' %}">
  <link rel="stylesheet" href="{% static 'css/LineIcons.css' %}">
  <link rel="stylesheet" href="{% static 'css/owl.carousel.css' %}">
  <link rel="stylesheet" href="{% static 'css/owl.theme.css' %}">
  <link rel="stylesheet" href="{% static 'css/magnific-popup.css' %}">
  <link rel="stylesheet" href="{% static 'css/nivo-lightbox.css' %}">
  <link rel="stylesheet" href="{% static 'css/main.css' %}">
  <link rel="stylesheet" href="{% static 'css/responsive.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <style>
    :root {
      --primary-color: #008445;
      --secondary-color: #ff6b6b;
      --accent-color: #4ecdc4;
      --dark-color: #2c3e50;
      --light-color: #f8f9fa;
      --admin-color: #9c27b0;
    }

    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .profile-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      margin-top: 30px;
      margin-bottom: 30px;
      overflow: hidden;
    }

    .profile-header {
      background: linear-gradient(45deg, 
        {% if is_admin %}var(--admin-color){% else %}var(--primary-color){% endif %}, 
        var(--accent-color));
      color: white;
      padding: 40px 0;
      text-align: center;
      position: relative;
    }

    .profile-avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: white;
      margin: 0 auto 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      color: {% if is_admin %}var(--admin-color){% else %}var(--primary-color){% endif %};
      border: 5px solid rgba(255, 255, 255, 0.3);
    }

    .profile-info-card {
      background: white;
      border-radius: 15px;
      padding: 30px;
      margin: -50px 20px 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      position: relative;
      z-index: 2;
    }

    .info-item {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      padding: 15px;
      border-radius: 10px;
      transition: all 0.3s ease;
      background: var(--light-color);
    }

    .info-item:hover {
      transform: translateX(10px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .info-icon {
      width: 50px;
      height: 50px;
      background: {% if is_admin %}var(--admin-color){% else %}var(--primary-color){% endif %};
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
      margin-right: 20px;
    }

    .identity-card-section {
      background: white;
      border-radius: 15px;
      padding: 30px;
      margin: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .card-section-title {
      color: var(--dark-color);
      border-left: 5px solid {% if is_admin %}var(--admin-color){% else %}var(--primary-color){% endif %};
      padding-left: 15px;
      margin-bottom: 30px;
    }

    .identity-card {
      border: none;
      border-radius: 15px;
      overflow: hidden;
      transition: all 0.3s ease;
      background: linear-gradient(145deg, #ffffff, #f0f0f0);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      margin-bottom: 25px;
    }

    .identity-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
    }

    .card-preview {
      height: 200px;
      background: linear-gradient(45deg, 
        {% if is_admin %}var(--admin-color){% else %}var(--primary-color){% endif %}, 
        var(--accent-color));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      position: relative;
      overflow: hidden;
    }

    .card-preview::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: rgba(255, 255, 255, 0.1);
      transform: rotate(45deg);
    }

    .card-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .btn-download {
      background: linear-gradient(45deg, 
        {% if is_admin %}var(--admin-color){% else %}var(--primary-color){% endif %}, 
        var(--accent-color));
      border: none;
      border-radius: 25px;
      padding: 10px 20px;
      color: white;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
    }

    .btn-download:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px 
        {% if is_admin %}rgba(156, 39, 176, 0.4){% else %}rgba(0, 132, 69, 0.4){% endif %};
      color: white;
      text-decoration: none;
    }

    .btn-whatsapp {
      background: linear-gradient(45deg, #25D366, #128C7E);
      border: none;
      border-radius: 25px;
      padding: 10px 20px;
      color: white;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
    }

    .btn-whatsapp:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(37, 211, 102, 0.4);
      color: white;
      text-decoration: none;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #6c757d;
    }

    .empty-state i {
      font-size: 64px;
      margin-bottom: 20px;
      color: #dee2e6;
    }

    /* Admin Dashboard Styles */
    .admin-dashboard {
      background: white;
      border-radius: 15px;
      padding: 30px;
      margin: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .admin-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(45deg, var(--admin-color), #ba68c8);
      color: white;
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .stat-card i {
      font-size: 36px;
      margin-bottom: 10px;
    }

    .stat-card h3 {
      font-size: 28px;
      margin: 10px 0;
    }

    .user-table-container {
      overflow-x: auto;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }

    .user-table {
      width: 100%;
      border-collapse: collapse;
    }

    .user-table th {
      background: var(--admin-color);
      color: white;
      padding: 15px;
      text-align: left;
    }

    .user-table tr:nth-child(even) {
      background-color: #f8f9fa;
    }

    .user-table tr:hover {
      background-color: #e9ecef;
    }

    .user-table td {
      padding: 12px 15px;
      border-bottom: 1px solid #dee2e6;
    }

    .badge {
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .badge-primary {
      background: var(--primary-color);
      color: white;
    }

    .badge-premium {
      background: #ff9800;
      color: white;
    }

    .badge-admin {
      background: var(--admin-color);
      color: white;
    }

    .btn-view-profile {
      background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
      border: none;
      border-radius: 20px;
      padding: 8px 15px;
      color: white;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .btn-view-profile:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 132, 69, 0.4);
      color: white;
      text-decoration: none;
    }

    @media (max-width: 768px) {
      .profile-info-card {
        margin: -30px 15px 20px;
        padding: 20px;
      }
      
      .card-actions {
        flex-direction: column;
      }
      
      .admin-stats {
        grid-template-columns: 1fr;
      }
      
      .user-table td {
        padding: 8px 10px;
      }
    }
  </style>
</head>

<body>

  <!-- Alert message -->
  {% if message %}
    <div class="container-fluid p-0 m-0">
      <div class="alert alert-info alert-dismissible fade show m-0 text-center" role="alert">
        {{ message }}
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    </div>
  {% endif %}

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark" style="background: linear-gradient(45deg, 
    {% if is_admin %}var(--admin-color){% else %}var(--dark-color){% endif %}, 
    var(--primary-color));">
    <div class="container">
      <a class="navbar-brand" href="/">
        <img src="{% static 'img/kate-logo.png' %}" alt="Navaratri Dandiya" height="60px">
      </a>
      
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="/">HOME</a>
          </li>
          {% if not is_admin %}
            <li class="nav-item">
              <a class="nav-link" href="{% url 'edit_profile' %}">EDIT PROFILE</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'change_password' %}">CHANGE PASSWORD</a>
            </li>
          {% else %}
            <li class="nav-item">
              <a class="nav-link" href="/admin/">ADMIN PANEL</a>
            </li>
          {% endif %}
          <li class="nav-item">
            <a class="nav-link" href="">LOGOUT</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container">
    <div class="profile-container">
      
      <!-- Admin Dashboard View -->
      {% if is_admin %}
        <!-- Profile Header -->
        <div class="profile-header">
          <div class="profile-avatar">
            <i class="fas fa-user-shield"></i>
          </div>
          <h2 class="display-4">Admin Dashboard</h2>
          <p class="lead">Welcome to the administrator panel</p>
        </div>

        <!-- Admin Stats -->
        <div class="admin-dashboard">
          <h3 class="card-section-title">System Overview</h3>
          
          <div class="admin-stats">
            <div class="stat-card">
              <i class="fas fa-users"></i>
              <h3>{{ users_with_counts|length }}</h3>
              <p>Total Users</p>
            </div>
            <div class="stat-card">
              <i class="fas fa-id-card"></i>
              <h3>{{ total_regular_cards }}</h3>
              <p>Regular Cards</p>
            </div>
            <div class="stat-card">
              <i class="fas fa-id-card-alt"></i>
              <h3>{{ total_premium_cards }}</h3>
              <p>Premium Cards</p>
            </div>
            <div class="stat-card">
              <i class="fas fa-chart-line"></i>
              <h3>{{ new_users_today }}</h3>
              <p>New Users Today</p>
            </div>
          </div>

          <h3 class="card-section-title">All Users ({{ users_with_counts|length }})</h3>
          
          <div class="user-table-container">
            <table class="user-table">
              <thead>
                <tr>
                  <th>User Info</th>
                  <th>Contact</th>
                  <th>Cards</th>
                  <th>Joined</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for user_data in users_with_counts %}
                  <tr>
                    <td>
                      <strong>{{ user_data.user.username }} {{ user_data.user.name }}</strong>
                      {% if user_data.user.is_superuser %}
                        <span class="badge badge-admin ml-2">Admin</span>
                      {% endif %}
                      <br>
                      <small class="text-muted">{{ user_data.user.name|default:"No name provided" }}</small>
                    </td>
                    <td>
                      {{ user_data.user.email }}<br>
                      <small class="text-muted">{{ user_data.user.phone|default:"No phone" }}</small>
                    </td>
                    <td>
                      <span class="badge badge-primary">{{ user_data.regular_card_count }} Regular</span>
                      <span class="badge badge-premium">{{ user_data.premium_card_count }} Premium</span>
                    </td>
                    <td>{{ user_data.user.date_joined|date:"M d, Y" }}</td>
                    <td>
                     <td>
    <a href="{% url 'admin_user_profile' user_data.user.id %}" class="btn-view-profile">
        <i class="fas fa-eye"></i> View Profile
    </a>
</td>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>

      <!-- Regular User View -->
      {% else %}
        <!-- Profile Header -->
        <div class="profile-header">
          <div class="profile-avatar">
            <i class="fas fa-user"></i>
          </div>
          <h2 class="display-4">{{ user.name|default:user.username }}</h2>
          <p class="lead">Welcome to your profile dashboard</p>
        </div>

        <!-- Profile Information -->
        <div class="profile-info-card">
          <div class="row">
            <div class="col-md-6">
              <div class="info-item">
                <div class="info-icon">
                  <i class="fas fa-user"></i>
                </div>
                <div>
                  <h6 class="mb-1">Full Name</h6>
                  <p class="mb-0 text-muted">{{ user.name|default:"Not provided" }}</p>
                </div>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="info-item">
                <div class="info-icon">
                  <i class="fas fa-phone"></i>
                </div>
                <div>
                  <h6 class="mb-1">Phone Number</h6>
                  <p class="mb-0 text-muted">{{ user.phone|default:"Not provided" }}</p>
                </div>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="info-item">
                <div class="info-icon">
                  <i class="fas fa-at"></i>
                </div>
                <div>
                  <h6 class="mb-1">Username</h6>
                  <p class="mb-0 text-muted">{{ user.username }}</p>
                </div>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="info-item">
                <div class="info-icon">
                  <i class="fas fa-calendar-alt"></i>
                </div>
                <div>
                  <h6 class="mb-1">Member Since</h6>
                  <p class="mb-0 text-muted">{{ user.date_joined|date:"F d, Y" }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Identity Cards Section -->
        <div class="identity-card-section">
          <h3 class="card-section-title">My Identity Cards</h3>
          
          {% if cards_detail %}
            <div class="row">
              {% for detail in cards_detail %}
                <div class="col-lg-4 col-md-6 mb-4">
                  <div class="identity-card">
                    <div class="card-preview">
                      <i class="fas fa-id-card"></i>
                      <span class="ml-2">Premium Card {{ forloop.counter }}</span>
                    </div>
                    <div class="card-body">
                      <h5 class="card-title">Premium Design {{ forloop.counter }}</h5>
                      <p class="card-text">Your exclusive identity card for Navaratri Dandiya events.</p>
                      
                      <div class="card-actions">
                        {% if detail.id %}
                          <a href="{% url 'cards:generate_premium_form' detail.id %}" class="btn-download">
                            <i class="fas fa-download"></i> Download Card
                          </a>
                          <a href="{% url 'cards:generate_premium_form' detail.id %}" class="btn-whatsapp">
                            <i class="fab fa-whatsapp"></i> Share
                          </a>
                        {% else %}
                          <span class="text-muted">Card ID not available</span>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <div class="empty-state">
              <i class="fas fa-id-card"></i>
              <h4>No Identity Cards Yet</h4>
              <p>You haven't created any identity cards. Create your first card to get started!</p>
              <a href="/#services" class="btn-download mt-3">
                <i class="fas fa-plus"></i> Create First Card
              </a>
            </div>
          {% endif %}
        </div>

        <!-- Regular Cards Section (if any) -->
        {% if cards %}
        <div class="identity-card-section">
          <h3 class="card-section-title">My Regular Cards</h3>
          <div class="row">
            {% for card in cards %}
              <div class="col-lg-4 col-md-6 mb-4">
                <div class="identity-card">
                  <div class="card-preview" style="background: linear-gradient(45deg, #ff6b6b, #ffa726);">
                    <i class="fas fa-credit-card"></i>
                    <span class="ml-2">Regular Card {{ forloop.counter }}</span>
                  </div>
                  <div class="card-body">
                    <h5 class="card-title">Regular Design {{ forloop.counter }}</h5>
                    <p class="card-text">Your standard identity card for events.</p>
                    <div class="card-actions">
                      {% if card.id %}
                        <a href="#" class="btn-download" style="background: linear-gradient(45deg, #ff6b6b, #ffa726);">
                          <i class="fas fa-download"></i> Download
                        </a>
                      {% else %}
                        <span class="text-muted">Card ID not available</span>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}
      {% endif %}

    </div>
  </div>

  <!-- JavaScript -->
  <script src="{% static 'js/jquery-min.js' %}"></script>
  <script src="{% static 'js/popper.min.js' %}"></script>
  <script src="{% static 'js/bootstrap.min.js' %}"></script>
  <script src="{% static 'js/owl.carousel.js' %}"></script>
  <script src="{% static 'js/jquery.nav.js' %}"></script>
  <script src="{% static 'js/scrolling-nav.js' %}"></script>
  <script src="{% static 'js/jquery.easing.min.js' %}"></script>
  <script src="{% static 'js/nivo-lightbox.js' %}"></script>
  <script src="{% static 'js/jquery.magnific-popup.min.js' %}"></script>
  <script src="{% static 'js/form-validator.min.js' %}"></script>
  <script src="{% static 'js/contact-form-script.js' %}"></script>
  <script src="{% static 'js/main.js' %}"></script>

  <script>
    // Auto-dismiss alerts
    setTimeout(function() {
      $('.alert').alert('close');
    }, 5000);

    // Smooth scrolling
    $(document).ready(function() {
      $('a[href^="#"]').on('click', function(event) {
        var target = $(this.getAttribute('href'));
        if (target.length) {
          event.preventDefault();
          $('html, body').stop().animate({
            scrollTop: target.offset().top - 70
          }, 1000);
        }
      });
    });

    // Add animation to cards on scroll
    $(window).scroll(function() {
      $('.identity-card').each(function() {
        var position = $(this).offset().top;
        var scrollPosition = $(window).scrollTop() + $(window).height();
        
        if (position < scrollPosition - 50) {
          $(this).addClass('animate__animated animate__fadeInUp');
        }
      });
    });
  </script>

</body>
</html>

{% endblock content %}